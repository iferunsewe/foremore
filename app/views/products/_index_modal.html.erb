<div class="modal" id="productsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title semi-bold">Find products</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= form_with url: products_path, method: :get, data: { controller: "search-form", search_form_target: "form", turbo_frame: "products" } do |form| %>
          <div class="row height d-flex justify-content-end mb-2 p-0 pe-md-2">
            <div class="col-12">
              <div class="form-floating">
                <%= form.text_field :query, class: 'form-control', value: params[:query], data: { action: "input->search-form#search" } %>
                <%= form.label :query, "Search by title" %>
              </div>
            </div>
          </div>
        <% end %>
        <%= turbo_frame_tag "products", class: "shadow overflow-hidden rounded border-b border-gray-200" do %>
          <div id="products">
            <div class="container">
              <div class="row">
                <% if @products&.empty? %>
                  <div class="col-12">
                    <h5 class="text-center">No products found</h5>
                  </div>
                <% else %>
                  <% @products.each do |product| %>
                    <div class="col-12 col-md-6 col-lg-4">
                      <div class="card">
                        <div class="card-body text-center">
                          <%= image_tag product.image_url, class: "card-img-top", width: "100px" %>
                          <div class="card-title"><%= product.name.capitalize %></div>
                          <%= form_with url: add_to_delivery_path(product_id: product.id), method: :post do |form| %>
                            <%= form.submit "Add", class: "btn btn-primary" %>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
            
          </div>

          <hr/>

          <div id="addedProducts">
            <table class="table table-hover table-borderless table-responsive">
              <tbody id="added-products-tbody">
                <% if @added_products&.empty? %>
                  <tr>
                    <td colspan="8" class="text-center">
                      <%= "No products added" %>
                    </td>
                  </tr>
                <% else %>
                  <% @added_products.each do |product| %>
                    <tr>
                      <td style="display:none;">
                        <div class="product-id"><%= product.id %></div>
                      </td>
                      <td>
                        <%= product.name.capitalize %>
                      </td>
                      <td>
                        <%= number_field_tag 'quantity', '1', class: "form-control product-quantity" %>
                      </td>
                      <td>
                        <%= form_with url: remove_from_delivery_path(product_id: product.id), method: :post do |form| %>
                          <%= form.submit "Remove", class: "btn btn-secondary" %>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>

        
      </div>

      <div class="modal-footer text-center">
        <button type="button" class="btn btn-success" data-bs-dismiss="modal" id="add-delivery-items-button">Add delivery items</button>
      </div>

    </div> 
  </div>
</div>
